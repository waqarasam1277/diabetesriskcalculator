<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TyG Clinical Risk Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .form-section {
            padding: 30px 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: "üìã";
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .results-section {
            background: #f7fafc;
            padding: 30px 20px;
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .results-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .results-title::before {
            content: "üìä";
            font-size: 20px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .result-label {
            font-size: 12px;
            color: #718096;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .result-value {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
        }

        .risk-zone {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .risk-badge {
            display: inline-block;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .risk-low {
            background: #c6f6d5;
            color: #22543d;
        }

        .risk-moderate {
            background: #fef5e7;
            color: #c05621;
        }

        .risk-high {
            background: #fed7d7;
            color: #c53030;
        }

        .risk-message {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .risk-message h4 {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .risk-message h4::before {
            content: "‚ù§Ô∏è";
            font-size: 16px;
        }

        .risk-message p {
            color: #4a5568;
            line-height: 1.6;
            font-size: 14px;
        }

        .lifestyle-advice {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .lifestyle-advice h4 {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .lifestyle-advice h4::before {
            content: "üí°";
            font-size: 16px;
        }

        .advice-list {
            list-style: none;
        }

        .advice-list li {
            color: #4a5568;
            line-height: 1.6;
            font-size: 14px;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .advice-list li::before {
            content: "‚Ä¢";
            color: #4facfe;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .buttons {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(79, 172, 254, 0.3);
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        .pdf-report {
            display: none;
            background: white;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }

        .pdf-header {
            text-align: center;
            border-bottom: 3px solid #4facfe;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .pdf-header h1 {
            color: #2d3748;
            font-size: 28px;
            margin-bottom: 5px;
        }

        .pdf-header p {
            color: #718096;
            font-size: 16px;
        }

        .pdf-section {
            margin-bottom: 30px;
        }

        .pdf-section h2 {
            color: #2d3748;
            font-size: 20px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .pdf-patient-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .pdf-info-group {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
        }

        .pdf-info-label {
            font-weight: bold;
            color: #4a5568;
            font-size: 14px;
        }

        .pdf-info-value {
            color: #2d3748;
            font-size: 16px;
            margin-top: 5px;
        }

        .pdf-results-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .pdf-result-card {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .pdf-result-label {
            font-size: 14px;
            color: #718096;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .pdf-result-value {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
        }

        .pdf-risk-assessment {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .pdf-risk-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .pdf-risk-low {
            background: #c6f6d5;
            color: #22543d;
        }

        .pdf-risk-moderate {
            background: #fef5e7;
            color: #c05621;
        }

        .pdf-risk-high {
            background: #fed7d7;
            color: #c53030;
        }

        .pdf-recommendations {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
        }

        .pdf-recommendations ul {
            list-style-type: disc;
            padding-left: 20px;
        }

        .pdf-recommendations li {
            margin-bottom: 8px;
            color: #4a5568;
        }

        .pdf-footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e2e8f0;
            text-align: center;
            color: #718096;
            font-size: 12px;
        }

        .chart-container {
            margin: 20px 0;
            text-align: center;
        }

        .risk-chart {
            display: inline-block;
            width: 300px;
            height: 20px;
            background: linear-gradient(to right, #c6f6d5 0%, #c6f6d5 33%, #fef5e7 33%, #fef5e7 66%, #fed7d7 66%, #fed7d7 100%);
            border-radius: 10px;
            position: relative;
            margin: 10px 0;
        }

        .risk-indicator {
            position: absolute;
            top: -5px;
            width: 30px;
            height: 30px;
            background: #2d3748;
            border-radius: 50%;
            transform: translateX(-50%);
        }

        .chart-labels {
            display: flex;
            justify-content: space-between;
            width: 300px;
            margin: 5px auto;
            font-size: 12px;
            color: #718096;
        }

        .validation-error {
            background: #fed7d7;
            color: #c53030;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .validation-error.show {
            display: block;
        }

        .save-message {
            background: #c6f6d5;
            color: #22543d;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .save-message.show {
            display: block;
        }

        .risk-gauge-container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .gauge-title {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .gauge-title::before {
            content: "üìä";
            font-size: 18px;
        }

        .risk-gauge {
            position: relative;
            width: 280px;
            height: 140px;
            margin: 0 auto 20px;
        }

        .gauge-background {
            width: 100%;
            height: 100%;
            background: conic-gradient(
                from 180deg,
                #c6f6d5 0deg 108deg,
                #fef5e7 108deg 144deg,
                #fed7d7 144deg 180deg
            );
            border-radius: 140px 140px 0 0;
            position: relative;
            overflow: hidden;
        }

        .gauge-background::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 100px;
            background: white;
            border-radius: 100px 100px 0 0;
        }

        .gauge-needle {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 4px;
            height: 120px;
            background: #2d3748;
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(-90deg);
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 2px 2px 0 0;
            z-index: 10;
        }

        .gauge-needle::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 16px;
            background: #2d3748;
            border-radius: 50%;
        }

        .gauge-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #718096;
            font-weight: 600;
        }

        .gauge-value {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            z-index: 15;
        }

        .reference-values {
            background: #f7fafc;
            padding: 25px 20px;
            border-top: 3px solid #4facfe;
        }

        .reference-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .reference-title::before {
            content: "üìã";
            font-size: 20px;
        }

        .reference-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .reference-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .reference-card h4 {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reference-ranges {
            list-style: none;
        }

        .reference-ranges li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
            font-size: 14px;
        }

        .reference-ranges li:last-child {
            border-bottom: none;
        }

        .range-label {
            font-weight: 600;
            color: #4a5568;
        }

        .range-value {
            color: #718096;
            font-family: 'Courier New', monospace;
        }

        .range-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .indicator-low { background: #68d391; }
        .indicator-moderate { background: #f6ad55; }
        .indicator-high { background: #fc8181; }
        .indicator-normal { background: #68d391; }
        .indicator-prediabetes { background: #f6ad55; }
        .indicator-diabetes { background: #fc8181; }
        .indicator-underweight { background: #90cdf4; }
        .indicator-overweight { background: #f6ad55; }
        .indicator-obese { background: #fc8181; }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 0;
                margin: 0;
                min-height: 100vh;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .results-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .risk-gauge {
                width: 240px;
                height: 120px;
            }

            .gauge-background::after {
                width: 160px;
                height: 80px;
            }

            .gauge-needle {
                height: 100px;
            }

            .reference-grid {
                grid-template-columns: 1fr;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 20px;
            }

            .form-section, .results-section {
                padding: 20px;
            }
        }

        @media (max-width: 360px) {
            .form-section, .results-section {
                padding: 15px;
            }

            .buttons {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TyG Clinical Risk Calculator</h1>
            <p>Metabolic and Diabetes Risk Assessment</p>
        </div>

        <div class="form-section">
            <div class="section-title">Patient Information</div>
            
            <div class="validation-error" id="validationError"></div>
            <div class="save-message" id="saveMessage"></div>

            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" id="name" placeholder="Enter patient name">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="age">Age</label>
                    <input type="number" id="age" placeholder="Years" min="1" max="120">
                </div>
                <div class="form-group">
                    <label for="gender">Gender</label>
                    <select id="gender">
                        <option value="">Select</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="weight">Weight (kg)</label>
                    <input type="number" id="weight" placeholder="kg" step="0.1" min="1">
                </div>
                <div class="form-group">
                    <label for="height">Height (m)</label>
                    <input type="number" id="height" placeholder="m" step="0.01" min="0.5" max="3">
                </div>
            </div>

            <div class="form-group">
                <label for="fastingGlucose">Fasting Glucose (mg/dL)</label>
                <input type="number" id="fastingGlucose" placeholder="mg/dL" min="50" max="500">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="triglycerides">Triglycerides (mg/dL)</label>
                    <input type="number" id="triglycerides" placeholder="mg/dL" min="10" max="1000">
                </div>
                <div class="form-group">
                    <label for="hdl">HDL (mg/dL)</label>
                    <input type="number" id="hdl" placeholder="mg/dL" min="10" max="200">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="hba1c">HbA1c (%)</label>
                    <input type="number" id="hba1c" placeholder="%" step="0.1" min="3" max="20">
                </div>
                <div class="form-group">
                    <label for="diabetesDiagnosis">Diabetes Status</label>
                    <select id="diabetesDiagnosis">
                        <option value="">Select</option>
                        <option value="No">No</option>
                        <option value="Prediabetes">Prediabetes</option>
                        <option value="Diabetes">Diabetes</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="results-section" id="resultsSection">
            <div class="results-title">Risk Assessment Results</div>
            
            <div class="results-grid">
                <div class="result-card">
                    <div class="result-label">BMI</div>
                    <div class="result-value" id="bmiValue">0</div>
                </div>
                <div class="result-card">
                    <div class="result-label">TyG Index</div>
                    <div class="result-value" id="tygValue">0</div>
                </div>
            </div>

            <div class="result-card">
                <div class="result-label">TG/HDL-C Ratio</div>
                <div class="result-value" id="ratioValue">0</div>
            </div>

            <div class="risk-zone">
                <div class="risk-badge" id="riskBadge">Low Risk</div>
            </div>

            <div class="risk-gauge-container">
                <div class="gauge-title">Risk Level Visualization</div>
                <div class="risk-gauge">
                    <div class="gauge-background"></div>
                    <div class="gauge-needle" id="gaugeNeedle"></div>
                    <div class="gauge-value" id="gaugeValue">0.0</div>
                </div>
                <div class="gauge-labels">
                    <span>Low Risk<br>&lt; 8.5</span>
                    <span>Moderate<br>8.5 - 8.99</span>
                    <span>High Risk<br>&gt; 8.99</span>
                </div>
            </div>

            <div class="risk-message">
                <h4>Risk Assessment</h4>
                <p id="riskMessageText"></p>
            </div>

            <div class="lifestyle-advice">
                <h4>Lifestyle Recommendations</h4>
                <ul class="advice-list" id="adviceList"></ul>
            </div>
        </div>

        <div class="buttons">
            <button class="btn btn-primary" onclick="saveAndCalculate()">
                üíæ Save & Calculate
            </button>
            <button class="btn btn-secondary" onclick="exportPDF()" id="exportBtn" style="display: none;">
                üìÑ Export PDF Report
            </button>
            <button class="btn btn-secondary" onclick="clearForm()">
                üîÑ Clear Form
            </button>
        </div>
    </div>

    <div class="reference-values">
        <div class="container">
            <div class="reference-title">Clinical Reference Values</div>
            <div class="reference-grid">
                <div class="reference-card">
                    <h4>üéØ TyG Index</h4>
                    <ul class="reference-ranges">
                        <li>
                            <span class="range-label">
                                <span class="range-indicator indicator-low"></span>
                                Low Risk
                            </span>
                            <span class="range-value">&lt; 8.5</span>
                        </li>
                        <li>
                            <span class="range-label">
                                <span class="range-indicator indicator-moderate"></span>
                                Moderate Risk
                            </span>
                            <span class="range-value">8.5 - 8.99</span>
                        </li>
                        <li>
                            <span class="range-label">
                                <span class="range-indicator indicator-high"></span>
                                High Risk
                            </span>
                            <span class="range-value">‚â• 9.0</span>
                        </li>
                    </ul>
                </div>

                <div class="reference-card">
                    <h4>‚öñÔ∏è BMI (Body Mass Index)</h4>
                    <ul class="reference-ranges">
                        <li>
                            <span class="range-label">
                                <span class="range-indicator indicator-underweight"></span>
                                Underweight
                            </span>
                            <span class="range-value">&lt; 18.5</span>
                        </li>
                        <li>
                            <span class="range-label">
                                <span class="range-indicator indicator-normal"></span>
                                Normal
                            </span>
                            <span class="range-value">18.5 - 24.9</span>
                        </li>
                        <li>
                            <span class="range-label">
                                <span class="range-indicator indicator-overweight"></span>
                                Overweight
                            </span>
                            <span class="range-value">25.0 - 29.9</span>
                        </li>
                        <li>
                            <span class="range-label">
                                <span class="range-indicator indicator-obese"></span>
                                Obese
                            </span>
                            <span class="range-value">‚â• 30.0</span>
                        </li>
                    </ul>
                </div>

                <div class="reference-card">
                    <h4>ü©∏ Fasting Glucose</h4>
                    <ul class="reference-ranges">
                        <li>
                            <span class="range-label">
                                <span class="range-indicator indicator-normal"></span>
                                Normal
                            </span>
                            <span class="range-value">&lt; 100 mg/dL</span>
                        </li>
                        <li>
                            <span class="range-label">
                                <span class="range-indicator indicator-prediabetes"></span>
                                Prediabetes
                            </span>
                            <span class="range-value">100 - 125 mg/dL</span>
                        </li>
                        <li>
                            <span class="range-label">
                                <span class="range-indicator indicator-diabetes"></span>
                                Diabetes
                            </span>
                            <span class="range-value">‚â• 126 mg/dL</span>
                        </li>
                    </ul>
                </div>

                <div class="reference-card">
                    <h4>üî¨ HbA1c (Hemoglobin A1c)</h4>
                    <ul class="reference-ranges">
                        <li>
                            <span class="range-label">
                                <span class="range-indicator indicator-normal"></span>
                                Normal
                            </span>
                            <span class="range-value">&lt; 5.7%</span>
                        </li>
                        <li>
                            <span class="range-label">
                                <span class="range-indicator indicator-prediabetes"></span>
                                Prediabetes
                            </span>
                            <span class="range-value">5.7 - 6.4%</span>
                        </li>
                        <li>
                            <span class="range-label">
                                <span class="range-indicator indicator-diabetes"></span>
                                Diabetes
                            </span>
                            <span class="range-value">‚â• 6.5%</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden PDF Report Template -->
    <div id="pdfReport" class="pdf-report">
        <div class="pdf-header">
            <h1>TyG Clinical Risk Assessment Report</h1>
            <p>Metabolic and Diabetes Risk Evaluation</p>
        </div>

        <div class="pdf-section">
            <h2>Patient Information</h2>
            <div class="pdf-patient-info">
                <div class="pdf-info-group">
                    <div class="pdf-info-label">Patient Name</div>
                    <div class="pdf-info-value" id="pdfName">-</div>
                </div>
                <div class="pdf-info-group">
                    <div class="pdf-info-label">Age</div>
                    <div class="pdf-info-value" id="pdfAge">-</div>
                </div>
                <div class="pdf-info-group">
                    <div class="pdf-info-label">Gender</div>
                    <div class="pdf-info-value" id="pdfGender">-</div>
                </div>
                <div class="pdf-info-group">
                    <div class="pdf-info-label">Report Date</div>
                    <div class="pdf-info-value" id="pdfDate">-</div>
                </div>
            </div>
        </div>

        <div class="pdf-section">
            <h2>Clinical Measurements</h2>
            <div class="pdf-patient-info">
                <div class="pdf-info-group">
                    <div class="pdf-info-label">Weight</div>
                    <div class="pdf-info-value" id="pdfWeight">-</div>
                </div>
                <div class="pdf-info-group">
                    <div class="pdf-info-label">Height</div>
                    <div class="pdf-info-value" id="pdfHeight">-</div>
                </div>
                <div class="pdf-info-group">
                    <div class="pdf-info-label">Fasting Glucose</div>
                    <div class="pdf-info-value" id="pdfGlucose">-</div>
                </div>
                <div class="pdf-info-group">
                    <div class="pdf-info-label">Triglycerides</div>
                    <div class="pdf-info-value" id="pdfTriglycerides">-</div>
                </div>
                <div class="pdf-info-group">
                    <div class="pdf-info-label">HDL Cholesterol</div>
                    <div class="pdf-info-value" id="pdfHDL">-</div>
                </div>
                <div class="pdf-info-group">
                    <div class="pdf-info-label">HbA1c</div>
                    <div class="pdf-info-value" id="pdfHbA1c">-</div>
                </div>
            </div>
        </div>

        <div class="pdf-section">
            <h2>Risk Assessment Results</h2>
            <div class="pdf-results-grid">
                <div class="pdf-result-card">
                    <div class="pdf-result-label">BMI</div>
                    <div class="pdf-result-value" id="pdfBMI">-</div>
                </div>
                <div class="pdf-result-card">
                    <div class="pdf-result-label">TyG Index</div>
                    <div class="pdf-result-value" id="pdfTyG">-</div>
                </div>
                <div class="pdf-result-card">
                    <div class="pdf-result-label">TG/HDL-C Ratio</div>
                    <div class="pdf-result-value" id="pdfRatio">-</div>
                </div>
            </div>

            <div class="chart-container">
                <h3>Risk Level Visualization</h3>
                <div class="risk-chart">
                    <div class="risk-indicator" id="riskIndicator"></div>
                </div>
                <div class="chart-labels">
                    <span>Low Risk<br>(&lt; 8.5)</span>
                    <span>Moderate Risk<br>(8.5 - 8.99)</span>
                    <span>High Risk<br>(&gt; 8.99)</span>
                </div>
            </div>

            <div class="pdf-risk-assessment">
                <div class="pdf-risk-badge" id="pdfRiskBadge">Low Risk</div>
                <p id="pdfRiskMessage">-</p>
            </div>
        </div>

        <div class="pdf-section">
            <h2>Clinical Recommendations</h2>
            <div class="pdf-recommendations">
                <ul id="pdfRecommendations">
                    <li>No recommendations available</li>
                </ul>
            </div>
        </div>

        <div class="pdf-section">
            <h2>Reference Values</h2>
            <div class="pdf-recommendations">
                <ul>
                    <li><strong>TyG Index:</strong> &lt; 8.5 (Low Risk), 8.5-8.99 (Moderate Risk), ‚â• 9.0 (High Risk)</li>
                    <li><strong>BMI:</strong> &lt; 18.5 (Underweight), 18.5-24.9 (Normal), 25-29.9 (Overweight), ‚â• 30 (Obese)</li>
                    <li><strong>Fasting Glucose:</strong> &lt; 100 mg/dL (Normal), 100-125 mg/dL (Prediabetes), ‚â• 126 mg/dL (Diabetes)</li>
                    <li><strong>HbA1c:</strong> &lt; 5.7% (Normal), 5.7-6.4% (Prediabetes), ‚â• 6.5% (Diabetes)</li>
                </ul>
            </div>
        </div>

        <div class="pdf-footer">
            <p>This report is generated by TyG Clinical Risk Calculator for clinical assessment purposes.</p>
            <p>Please consult with a healthcare professional for proper medical interpretation and treatment decisions.</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Form elements
        const formElements = {
            name: document.getElementById('name'),
            age: document.getElementById('age'),
            gender: document.getElementById('gender'),
            weight: document.getElementById('weight'),
            height: document.getElementById('height'),
            fastingGlucose: document.getElementById('fastingGlucose'),
            triglycerides: document.getElementById('triglycerides'),
            hdl: document.getElementById('hdl'),
            hba1c: document.getElementById('hba1c'),
            diabetesDiagnosis: document.getElementById('diabetesDiagnosis')
        };

        // Result elements
        const resultElements = {
            section: document.getElementById('resultsSection'),
            bmi: document.getElementById('bmiValue'),
            tyg: document.getElementById('tygValue'),
            ratio: document.getElementById('ratioValue'),
            badge: document.getElementById('riskBadge'),
            message: document.getElementById('riskMessageText'),
            advice: document.getElementById('adviceList')
        };

        // Message elements
        const messageElements = {
            validation: document.getElementById('validationError'),
            save: document.getElementById('saveMessage')
        };

        // Export button
        const exportBtn = document.getElementById('exportBtn');

        // Add event listeners for real-time calculation
        Object.values(formElements).forEach(element => {
            element.addEventListener('input', debounce(calculateResults, 300));
            element.addEventListener('change', calculateResults);
        });

        // Debounce function to prevent excessive calculations during typing
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function calculateResults() {
            // Clear any previous validation errors when user starts typing
            messageElements.validation.classList.remove('show');
            
            const weight = parseFloat(formElements.weight.value);
            const height = parseFloat(formElements.height.value);
            const fastingGlucose = parseFloat(formElements.fastingGlucose.value);
            const triglycerides = parseFloat(formElements.triglycerides.value);
            const hdl = parseFloat(formElements.hdl.value);

            // Check if we have the minimum required values
            if (!weight || !height || !fastingGlucose || !triglycerides || !hdl) {
                resultElements.section.classList.remove('show');
                return;
            }

            // Validate numeric ranges
            if (weight <= 0 || height <= 0 || fastingGlucose <= 0 || triglycerides <= 0 || hdl <= 0) {
                resultElements.section.classList.remove('show');
                return;
            }

            // Calculate BMI
            const bmi = weight / (height * height);

            // Calculate TyG Index
            const tygIndex = Math.log((triglycerides * fastingGlucose) / 2);

            // Calculate TG/HDL-C Ratio
            const tgHdlRatio = triglycerides / hdl;

            // Determine risk zone
            let riskZone, riskClass;
            if (tygIndex < 8.5) {
                riskZone = 'Low Risk';
                riskClass = 'risk-low';
            } else if (tygIndex >= 8.5 && tygIndex <= 8.99) {
                riskZone = 'Moderate Risk';
                riskClass = 'risk-moderate';
            } else {
                riskZone = 'High Risk';
                riskClass = 'risk-high';
            }

            // Update results display
            resultElements.bmi.textContent = bmi.toFixed(2);
            resultElements.tyg.textContent = tygIndex.toFixed(2);
            resultElements.ratio.textContent = tgHdlRatio.toFixed(2);
            
            resultElements.badge.textContent = riskZone;
            resultElements.badge.className = `risk-badge ${riskClass}`;

            // Update risk gauge
            updateRiskGauge(tygIndex);

            // Generate risk message
            const age = formElements.age.value;
            const gender = formElements.gender.value;
            const diabetesDiagnosis = formElements.diabetesDiagnosis.value;
            
            const riskMessage = generateRiskMessage(age, gender, diabetesDiagnosis, tygIndex, riskZone);
            resultElements.message.textContent = riskMessage;

            // Generate lifestyle advice
            const lifestyleAdvice = generateLifestyleAdvice(bmi, diabetesDiagnosis);
            resultElements.advice.innerHTML = '';
            lifestyleAdvice.forEach(advice => {
                const li = document.createElement('li');
                li.textContent = advice;
                resultElements.advice.appendChild(li);
            });

            // Show results section
            resultElements.section.classList.add('show');
            
            // Show export button
            exportBtn.style.display = 'block';
        }

        function updateRiskGauge(tygValue) {
            const needle = document.getElementById('gaugeNeedle');
            const gaugeValueDisplay = document.getElementById('gaugeValue');
            
            // Update gauge value display
            gaugeValueDisplay.textContent = tygValue.toFixed(2);
            
            // Calculate needle rotation (-90deg to 90deg, total 180deg range)
            let rotation;
            
            if (tygValue < 8.5) {
                // Low risk: -90deg to -30deg (60deg range)
                const normalizedValue = Math.max(0, Math.min(1, (tygValue - 7.5) / 1.0));
                rotation = -90 + (normalizedValue * 60);
            } else if (tygValue <= 8.99) {
                // Moderate risk: -30deg to 30deg (60deg range)
                const normalizedValue = (tygValue - 8.5) / 0.49;
                rotation = -30 + (normalizedValue * 60);
            } else {
                // High risk: 30deg to 90deg (60deg range)
                const normalizedValue = Math.min(1, (tygValue - 9.0) / 1.0);
                rotation = 30 + (normalizedValue * 60);
            }
            
            needle.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
        }

        function generateRiskMessage(age, gender, diabetesDiagnosis, tygIndex, riskZone) {
            const ageStr = age ? `${age}-year-old` : '';
            const genderStr = gender ? gender.toLowerCase() : 'patient';
            const tygStr = `TyG ${tygIndex.toFixed(1)} (${riskZone})`;
            
            let message = `${ageStr} ${genderStr} with ${tygStr}`;
            
            if (diabetesDiagnosis === 'Diabetes' && riskZone === 'High Risk') {
                message += ' and Diabetes ‚Üí High chance of kidney and eye complications. Needs urgent lifestyle intervention and medical follow-up.';
            } else if (diabetesDiagnosis === 'Prediabetes' && riskZone === 'High Risk') {
                message += ' and Prediabetes ‚Üí High risk of developing diabetes. Immediate lifestyle changes recommended.';
            } else if (riskZone === 'High Risk') {
                message += ' ‚Üí High metabolic risk. Consider diabetes screening and lifestyle modifications.';
            } else if (riskZone === 'Moderate Risk') {
                message += ' ‚Üí Moderate metabolic risk. Preventive measures recommended.';
            } else {
                message += ' ‚Üí Low metabolic risk. Continue healthy lifestyle habits.';
            }
            
            return message;
        }

        function generateLifestyleAdvice(bmi, diabetesDiagnosis) {
            const advice = [
                'Eat more fiber, fruits, vegetables, and whole grains',
                'Avoid sugary and fried foods',
                'Exercise 30-40 minutes daily'
            ];

            if (bmi >= 25) {
                advice.push('Recommend gradual weight loss');
            }

            if (diabetesDiagnosis === 'Diabetes') {
                advice.push('Regular HbA1c, kidney, and eye checkups');
            }

            return advice;
        }

        function validateForm() {
            const requiredFields = ["name", "age", "gender", "weight", "height", "fastingGlucose", "triglycerides", "hdl"];
            const missingFields = [];
            const invalidFields = [];

            requiredFields.forEach(field => {
                const value = formElements[field].value;
                if (!value || value === "") {
                    missingFields.push(field);
                } else if (["age", "weight", "height", "fastingGlucose", "triglycerides", "hdl"].includes(field)) {
                    const numValue = parseFloat(value);
                    if (isNaN(numValue) || numValue <= 0) {
                        invalidFields.push(field);
                    }
                }
            });

            return {
                isValid: missingFields.length === 0 && invalidFields.length === 0,
                missingFields,
                invalidFields
            };
        }

        function saveAndCalculate() {
            // Clear previous messages
            messageElements.validation.classList.remove('show');
            messageElements.save.classList.remove('show');

            // Validate form
            const validation = validateForm();
            if (!validation.isValid) {
                let errorMessage = "";
                if (validation.missingFields.length > 0) {
                    errorMessage += `Please fill in the following required fields: ${validation.missingFields.join(", ")}`;
                }
                if (validation.invalidFields.length > 0) {
                    if (errorMessage) errorMessage += ". ";
                    errorMessage += `Please enter valid positive numbers for: ${validation.invalidFields.join(", ")}`;
                }
                messageElements.validation.textContent = errorMessage;
                messageElements.validation.classList.add('show');
                return;
            }

            // Ensure calculations are up to date
            calculateResults();

            // Show success message
            messageElements.save.textContent = "Data saved successfully! You can now export the PDF report.";
            messageElements.save.classList.add('show');
            
            // Hide success message after 3 seconds
            setTimeout(() => {
                messageElements.save.classList.remove('show');
            }, 3000);
        }

        function exportPDF() {
            // Populate PDF template with current data
            populatePDFTemplate();
            
            // Show PDF template temporarily for capture
            const pdfReport = document.getElementById('pdfReport');
            pdfReport.style.display = 'block';
            
            // Use html2canvas to capture the PDF template
            html2canvas(pdfReport, {
                scale: 2,
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                // Hide PDF template
                pdfReport.style.display = 'none';
                
                // Create PDF using jsPDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210; // A4 width in mm
                const pageHeight = 295; // A4 height in mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                
                let position = 0;
                
                // Add first page
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                // Add additional pages if needed
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Generate filename with patient name and date
                const patientName = formElements.name.value.replace(/[^a-zA-Z0-9]/g, '_');
                const date = new Date().toISOString().split('T')[0];
                const filename = `TyG_Risk_Report_${patientName}_${date}.pdf`;
                
                // Save the PDF
                pdf.save(filename);
                
                // Show success message
                messageElements.save.textContent = "PDF report generated and downloaded successfully!";
                messageElements.save.classList.add('show');
                
                setTimeout(() => {
                    messageElements.save.classList.remove('show');
                }, 3000);
            }).catch(error => {
                console.error('Error generating PDF:', error);
                pdfReport.style.display = 'none';
                
                messageElements.validation.textContent = "Error generating PDF report. Please try again.";
                messageElements.validation.classList.add('show');
                
                setTimeout(() => {
                    messageElements.validation.classList.remove('show');
                }, 3000);
            });
        }

        function populatePDFTemplate() {
            // Patient Information
            document.getElementById('pdfName').textContent = formElements.name.value;
            document.getElementById('pdfAge').textContent = formElements.age.value + ' years';
            document.getElementById('pdfGender').textContent = formElements.gender.value;
            document.getElementById('pdfDate').textContent = new Date().toLocaleDateString();
            
            // Clinical Measurements
            document.getElementById('pdfWeight').textContent = formElements.weight.value + ' kg';
            document.getElementById('pdfHeight').textContent = formElements.height.value + ' m';
            document.getElementById('pdfGlucose').textContent = formElements.fastingGlucose.value + ' mg/dL';
            document.getElementById('pdfTriglycerides').textContent = formElements.triglycerides.value + ' mg/dL';
            document.getElementById('pdfHDL').textContent = formElements.hdl.value + ' mg/dL';
            document.getElementById('pdfHbA1c').textContent = formElements.hba1c.value ? formElements.hba1c.value + '%' : 'Not provided';
            
            // Results
            document.getElementById('pdfBMI').textContent = resultElements.bmi.textContent;
            document.getElementById('pdfTyG').textContent = resultElements.tyg.textContent;
            document.getElementById('pdfRatio').textContent = resultElements.ratio.textContent;
            
            // Risk Assessment
            const riskBadge = document.getElementById('pdfRiskBadge');
            riskBadge.textContent = resultElements.badge.textContent;
            riskBadge.className = `pdf-risk-badge pdf-${resultElements.badge.className.split(' ')[1]}`;
            
            document.getElementById('pdfRiskMessage').textContent = resultElements.message.textContent;
            
            // Position risk indicator on chart
            const tygValue = parseFloat(resultElements.tyg.textContent);
            const indicator = document.getElementById('riskIndicator');
            let position;
            
            if (tygValue < 8.5) {
                position = (tygValue - 7.5) / 1.0 * 33; // Scale to 0-33%
                position = Math.max(5, Math.min(28, position)); // Keep within bounds
            } else if (tygValue <= 8.99) {
                position = 33 + ((tygValue - 8.5) / 0.49 * 33); // Scale to 33-66%
                position = Math.max(38, Math.min(61, position));
            } else {
                position = 66 + ((Math.min(tygValue, 10) - 9) / 1.0 * 33); // Scale to 66-100%
                position = Math.max(71, Math.min(95, position));
            }
            
            indicator.style.left = position + '%';
            
            // Recommendations
            const recommendationsList = document.getElementById('pdfRecommendations');
            recommendationsList.innerHTML = '';
            
            Array.from(resultElements.advice.children).forEach(li => {
                const newLi = document.createElement('li');
                newLi.textContent = li.textContent;
                recommendationsList.appendChild(newLi);
            });
            
            // Add additional clinical recommendations based on risk level
            const additionalRecommendations = getAdditionalRecommendations();
            additionalRecommendations.forEach(rec => {
                const li = document.createElement('li');
                li.textContent = rec;
                recommendationsList.appendChild(li);
            });
        }

        function getAdditionalRecommendations() {
            const recommendations = [];
            const tygValue = parseFloat(resultElements.tyg.textContent);
            const diabetesDiagnosis = formElements.diabetesDiagnosis.value;
            
            if (tygValue >= 9.0) {
                recommendations.push('Consider referral to endocrinologist for comprehensive metabolic evaluation');
                recommendations.push('Monitor blood pressure and cardiovascular risk factors closely');
            }
            
            if (diabetesDiagnosis === 'Diabetes') {
                recommendations.push('Schedule regular ophthalmologic examinations');
                recommendations.push('Monitor kidney function with annual microalbumin testing');
                recommendations.push('Consider cardioprotective medications as appropriate');
            }
            
            if (diabetesDiagnosis === 'Prediabetes' || tygValue >= 8.5) {
                recommendations.push('Consider diabetes prevention program enrollment');
                recommendations.push('Recheck HbA1c and lipid profile in 3-6 months');
            }
            
            recommendations.push('Follow up with healthcare provider to discuss results and treatment plan');
            
            return recommendations;
        }

        function clearForm() {
            // Clear all form fields
            Object.values(formElements).forEach(element => {
                element.value = "";
            });

            // Hide results section
            resultElements.section.classList.remove('show');

            // Hide export button
            exportBtn.style.display = 'none';

            // Clear messages
            messageElements.validation.classList.remove('show');
            messageElements.save.classList.remove('show');
        }
    </script>
</body>
</html>